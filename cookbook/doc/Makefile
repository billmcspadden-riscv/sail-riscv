# vim: set tabstop=4 shiftwidth=4 noexpandtab
# ================================================================
# Filename:		Makefile
#
# Description:	Makefile for building a complete RISC-V Sail cookbook
#
# 				asciidoctor-reducer needs to be installed
#
# 				Because github does not handle 'include' directives,
#				we use asciidoctor-reducer to pull in the various
#				include files into one adoc file which can be
#				rendered by github.
#
#				NOTE: Some git trickery is needed in order to ensure that
#				the complete file has been compiled to the latest 
#				level and then committed.  See the .git/hooks/pre-commit
#				and .git/hooks/post-commit so see how this is done.
#
# Author(s):	Bill McSpadden (bill@riscv.org)
#
# Revision:		See git logs
#
# ================================================================

#==============
# Includes
#==============


#==============
# Make variables
#==============

FINAL_ADOC_TARGET 		:= TheRISCVSailCookbook_Complete.adoc
TOP_ADOC_FILE			:= TheRISCVSailCookbook_Main.adoc
FINAL_PDF_TARGET		:= TheRISCVSailCookbook_Complete.pdf

ALL_DEPENDENCIES		:= 
CODE_SNIPPETS_DIR 		:= ../functional_code_examples
ALL_DEPENDENCIES		+= 

# hello_world example
#HELLO_WORLD_DIR 		:= ${CODE_SNIPPETS_DIR}/hello_world
#HELLO_WORLD_FILES		:= ${HELLO_WORLD_DIR}/hello_world.sail  ${HELLO_WORLD_DIR}/Makefile

ALL_DEPENDENCIES		+= ${HELLO_WORLD_FILES}


TMP_ADOC				:= ./tmp.adoc

#==============
# Targets and rules
#==============
all : ${FINAL_ADOC_TARGET} ${FINAL_PDF_TARGET}

echo_final_adoc_target :
	echo ${FINAL_ADOC_TARGET} ;


${FINAL_ADOC_TARGET} : ${TOP_ADOC_FILE} ${ALL_DEPENDENCIES}
	asciidoctor-reducer $< -o $@ ;
	rm -f ${TMP_ADOC} ;
	echo "// =========================================================================" >> ${TMP_ADOC} ;
	echo "// DO NOT EDIT.  AUTOGENERATED FILE.  You probably want to edit $<"           >> ${TMP_ADOC} ;
	echo "// =========================================================================" >> ${TMP_ADOC} ;
	mv $@ $@.tmp ;
	cat ${TMP_ADOC} $@.tmp > $@ ;
	rm -f $@.tmp ${TMP_ADOC} ;

${FINAL_PDF_TARGET} : ${FINAL_ADOC_TARGET}
	asciidoctor-pdf $<


.PHONY: clean
clean:
	rm -f ${FINAL_ADOC_TARGET} ${FINAL_PDF_TARGET} ${TMP_ADOC} 




